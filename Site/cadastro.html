<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Escola de Música - Ourinhos</title>
    <link rel="icon" type="image/png" href="favicon.ico">
    <style>
        @import url(https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300);
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-weight: 300;
        }
        body {
            font-family: 'Source Sans Pro', sans-serif;
            color: white;
            font-weight: 300;
        }
        body ::-webkit-input-placeholder {
            font-family: 'Source Sans Pro', sans-serif;
            color: white;
            font-weight: 300;
        }
        body :-moz-placeholder {
            font-family: 'Source Sans Pro', sans-serif;
            color: white;
            opacity: 1;
            font-weight: 300;
        }
        body ::-moz-placeholder {
            font-family: 'Source Sans Pro', sans-serif;
            color: white;
            opacity: 1;
            font-weight: 300;
        }
        body :-ms-input-placeholder {
            font-family: 'Source Sans Pro', sans-serif;
            color: white;
            font-weight: 300;
        }
        .wrapper {
            
            background: linear-gradient(135deg, #000000, #1f1e1e);            
            position: absolute;
            top: 0%;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 80px 0;
            height: 400px;
            text-align: center;
        }
        .container h1 {
            font-size: 40px;
            transition-duration: 1s;
            transition-timing-function: ease-in-out;
            font-weight: 200;
        }
        form {
            padding: 20px 0;
            position: relative;
            z-index: 2;
        }
        form input {
            outline: 0;
            border: 1px solid rgba(255, 255, 255, 0.4);
            background-color: rgba(255, 255, 255, 0.2);
            width: 250px;
            border-radius: 3px;
            padding: 10px 15px;
            margin: 0 auto 10px auto;
            display: block;
            text-align: center;
            font-size: 18px;
            color: white;
            transition-duration: 0.25s;
            font-weight: 300;
        }
        form input:hover {
            background-color: rgba(255, 255, 255, 0.4);
        }
        form input:focus {
            background-color: white;
            width: 300px;
            color: #191a19;
        }
        form button {
            outline: 0;
            background-color:  rgb(255, 255, 255);
            border: 0;
            padding: 10px 15px;
            color: #252525;
            border-radius: 3px;
            width: 250px;
            cursor: pointer;
            font-size: 18px;
            transition-duration: 0.25s;
        }
        form button:hover {
            background-color: #f5f7f9;
        }
        .bg-bubbles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
        .bg-bubbles li {
            position: absolute;
            list-style: none;
            display: block;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.15);
            bottom: -160px;
            animation: square 25s infinite;
            transition-timing-function: linear;
        }
        .bg-bubbles li:nth-child(1) { left: 10%; }
        .bg-bubbles li:nth-child(2) { left: 20%; width: 80px; height: 80px; animation-delay: 2s; animation-duration: 17s; }
        .bg-bubbles li:nth-child(3) { left: 25%; animation-delay: 4s; }
        .bg-bubbles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-duration: 22s; background-color: rgba(255, 255, 255, 0.25); }
        .bg-bubbles li:nth-child(5) { left: 70%; }
        .bg-bubbles li:nth-child(6) { left: 80%; width: 120px; height: 120px; animation-delay: 3s; background-color: rgba(255, 255, 255, 0.2); }
        .bg-bubbles li:nth-child(7) { left: 32%; width: 160px; height: 160px; animation-delay: 7s; }
        .bg-bubbles li:nth-child(8) { left: 55%; width: 20px; height: 20px; animation-delay: 15s; animation-duration: 40s; }
        .bg-bubbles li:nth-child(9) { left: 25%; width: 10px; height: 10px; animation-delay: 2s; animation-duration: 40s; background-color: rgba(255, 255, 255, 0.3); }
        .bg-bubbles li:nth-child(10) { left: 90%; width: 160px; height: 160px; animation-delay: 11s; }

        @keyframes square {
            0% { transform: translateY(0); }
            100% { transform: translateY(-700px) rotate(600deg); }
        }

         .error-message {
            color: rgb(245, 245, 245);
            font-size: 14px;
            display: none; /* Inicialmente oculto */
        }
        /* Estilo para o botão de Voltar para Home no topo */
         .home-button {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 10px 15px;
            background-color: #ffffff;
            color: #252525;
            border-radius: 3px;
            text-decoration: none;
            font-size: 18px;
            transition-duration: 0.25s;
            z-index: 9999999999999;
        }

        .home-button:hover {
            background-color: #f5f7f9;
        }

        a {
            color: white;
        }
       /* Preloader */
       #preloader {
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: #000000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            overflow: hidden;
            opacity: 1;
            transition: opacity 1s ease; /* Transição para fade-in */
        }

        .preloader-notes {
            position: relative;
            width: 100%;
            height: 80px; /* Ajuste a altura para aproximar as notas */
        }

        .preloader-notes .note {
            position: absolute;
            font-size: 2em;
            color: #ffffff;
            animation: preloader-float 3s linear infinite;
            opacity: 0;
        }

        @keyframes preloader-float {
            0% {
                transform: translateY(100%);
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100%);
                opacity: 0;
            }
        }

        .preloader-notes .note:nth-child(1) {
            left: 45%; /* Centraliza as notas em relação ao texto */
            animation-delay: 0s;
        }

        .preloader-notes .note:nth-child(2) {
            left: 50%;
            animation-delay: 0.5s;
        }

        .preloader-notes .note:nth-child(3) {
            left: 55%;
            animation-delay: 1s;
        }

        .preloader-notes .note:nth-child(4) {
            left: 60%;
            animation-delay: 1.5s;
        }

        #preloader p {
            margin-top: 20px;
            font-size: 1.2em;
            color: #ffffff;
        }

        .error-message {
            color: red;
            font-weight: bold;
            display: none; /* Inicialmente oculto */
        }
    </style>
   

    </script>
</head>
<body>
     <!-- Preloader temático -->
     <div id="preloader">
        <div class="preloader-notes">
            <div class="note">♪</div>
            <div class="note">♫</div>
            <div class="note">♩</div>
            
        </div>
        <p>Carregando...</p>
    </div>
    <div class="wrapper">
         <!-- Botão Voltar para Home no canto superior esquerdo -->
         <a href="index2.html" class="home-button">Home</a>

        <div class="container">
            <h1>Cadastre-se</h1>
            <form method="post" action="adicionar.php">
              
                <input type="text" name="cpf" id="cpf" placeholder="CPF" required>
                <span class="error-message" id="cpf-error"></span>
                <br>
                <input type="password" name="senha" id="senha" placeholder="Senha" required>
                <span class="error-message" id="senha-error"></span>
                <br>
                <button type="submit" id="login-button">Cadastrar</button>   
                <br><br>             
                <h2>Já possui cadastro? <a href="login.html">Entre aqui</a></h2>
            </form>
             <div id="error-message" class="error-message"></div>
        </div>
        <ul class="bg-bubbles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>





  <script>
   
        document.addEventListener("DOMContentLoaded", function() {
            var cpfInput = document.querySelector("#cpf");
            var senhaInput = document.querySelector("#senha");
            var form = document.querySelector("form");
            var cpfError = document.querySelector("#cpf-error");
            var senhaError = document.querySelector("#senha-error");
            

            cpfInput.addEventListener("input", function() {
                cpfInput.value = formatCPF(cpfInput.value);
            });

            senhaInput.addEventListener("input", function() {
                senhaInput.value = formatSenha(senhaInput.value);
            });

            form.addEventListener("submit", function(event) {
    event.preventDefault(); // Impede o envio do formulário inicialmente
    console.log("Formulário enviado");

    // Resetar mensagens de erro
    cpfError.style.display = 'none';
    senhaError.style.display = 'none';
    var hasError = false;

    // Remover formatação do CPF antes de validação e envio
    var cpfLimpo = cpfInput.value.replace(/\D/g, ""); // Remove todos os caracteres que não sejam dígitos
    cpfInput.value = cpfLimpo; // Atualiza o campo com o CPF sem formatação para envio
    console.log("CPF limpo:", cpfLimpo);

    if (cpfLimpo.length != 11) {
        cpfError.textContent = "CPF inválido. Deve conter 11 dígitos.";
        cpfError.style.display = 'block';
        hasError = true;
    }

    if (senhaInput.value.length < 5) {
        senhaError.textContent = "Senha inválida. Deve conter pelo menos 5 caracteres.";
        senhaError.style.display = 'block';
        hasError = true;
    }

    if (!hasError) {
        // Use fetch para enviar o formulário e verificar a resposta
        fetch('adicionar.php', {
            method: 'POST',
            body: new FormData(form)
        })
        .then(response => response.text()) // Use text() ao invés de json() para ver a resposta bruta
        .then(data => {
            console.log("Resposta bruta do servidor:", data);
            try {
                const jsonData = JSON.parse(data);
                console.log("Resposta JSON do servidor:", jsonData);
                if (jsonData.success) {
                 
                        window.location.href = 'login.html'; // Redireciona após sucesso
                    
                } else {
                    alert(jsonData.message);
                }
            } catch (error) {
                console.error('Erro ao parsear JSON:', error);
                alert('Erro ao processar a solicitação.');
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao processar a solicitação.');
        });
    }
});


            function formatCPF(value) {
                value = value.replace(/\D/g, ""); // Remove caracteres não numéricos

                if (value.length > 11) {
                    value = value.substring(0, 11); // Limita ao máximo de 11 dígitos
                }

                return value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, function(_, p1, p2, p3, p4) {
                    return `${p1}.${p2}.${p3}-${p4}`;
                });
            }

            function formatSenha(value) {
                if (value.length > 11) {
                    return value.substring(0, 11); // Limita ao máximo de 11 caracteres
                }
                return value;
            }

            

            

            function getQueryParameter(name) {
                let urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            }

            let errorCode = getQueryParameter('erro');

            if (errorCode) {
                let errorMessage = "";

                switch (errorCode) {
                    case "1":
                        errorMessage = "Erro ao cadastrar o usuário. Tente novamente mais tarde.";
                        break;
                    default:
                        errorMessage = "Ocorreu um erro desconhecido.";
                }

                const errorMessageElement = document.getElementById("error-message");
                if (errorMessageElement) {
                    errorMessageElement.innerText = errorMessage;
                    errorMessageElement.style.display = 'block';
                }
            }
        
    });
    window.addEventListener('load', () => {
                setTimeout(() => {
                    const preloader = document.getElementById('preloader');
                    preloader.style.opacity = '0'; // Fade-out effect
                    setTimeout(() => {
                        preloader.style.display = 'none'; // Remove preloader after fade-out
                    }, 1000); // Tempo do fade-out
                }, 2000); // 2000ms = 2 segundos
            });
  </script>
</body>
</html>